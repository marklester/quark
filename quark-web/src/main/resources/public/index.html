
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="favicon.ico">

<title>Quark</title>

<!-- Bootstrap core CSS -->
<link rel='stylesheet'
  href='/webjars/bootstrap/4.0.0/css/bootstrap.min.css'>

<!-- Custom styles for this template -->
<link href="css/dashboard.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Quark</a>
    <ul class="navbar-nav px-3">

    </ul>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column" id="menu">
            <li class="nav-item"><a class="nav-link active"
              href="#"> <span class="fas fa-list-alt"></span> Orders
                <span class="sr-only">(current)</span>
            </a></li>
            <li class="nav-item"><a class="nav-link" href="#">
                <span class="fas fa-stopwatch"></span> Simulations
            </a></li>
          </ul>
        </div>
      </nav>

      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
      <div
        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Simulation:<span id="simId"></span></h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <form class="form-inline" id="run">
            <div class="form-group mb-2">
              <input type="number" class="form-control" id="short"
                placeholder="Tick Rate" value="1">
            </div>
            <div class="form-group mb-2 col-auto">
              <input type="number" class="form-control" id="short"
                placeholder="Short Average" value="1">
            </div>
            <div class="form-group mx-sm-3 mb-2">

              <input type="number" class="form-control" id="long"
                placeholder="Long Average" value="3">


            </div>
            <button type="submit" class="btn btn-primary mb-2">Run
              Simulation</button>
          </form>
        </div>
      </div>

      <div id="avg-chart" width="900" height="380"></div>
      <div id="buy-sell-chart" width="900" height="380"></div>
      </main>
    </div>
  </div>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="/webjars/jquery/jquery.min.js"></script>
  <script src="/webjars/popper.js/dist/umd/popper.min.js"></script>
  <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>

  <!-- Icons -->
  <script
    src="/webjars/font-awesome/on-server/js/fontawesome-all.min.js"></script>

  <!-- Graphs -->
  <script src="/webjars/plotly.js/dist/plotly.min.js"></script>
  <script>
  $(document).ready(function() { 
  var updateData= function(sid){
	  console.log("waiting for data");
			$("#simId").text(sid);
	$.get("/api/simulation/"+sid, function(data, status){			  
	  console.log("data"+data);
		if(!$.isEmptyObject(data)){
			  var lineData = data.filter(function(el){return el.type==='scatter'});

			  var barData = data.filter(function(el){return el.type==='bar'});
			  console.log("bd"+JSON.stringify(barData,undefined,2));
			  Plotly.newPlot("avg-chart", lineData);
			  Plotly.newPlot("buy-sell-chart", barData);
		      clearInterval(timerId);
		}		
	})  
  };
  var timerId =null;
  $.get("/api/simulations",function(data,status){
	  console.log("simulations");
	  $(data).each(function(i,item){
		  var li 
		  var li = $('<li class="nav-item">');
		  var a = $('<a class="nav-link" href="#">').text(item);
		  li.append(a);
		  $(a).click(function(e){
			  console.log("click"+item);
			  updateData(item);
		  });
		  $("#menu").append(li);
	  });
  });
  
  $("#run").submit(function(e){
      e.preventDefault();
	  console.log("run simulation");
	  $.get("/api/simulate",{tickRate:1,shortAvg:1,longAvg:3}, 
    		function(data, status){
    			console.log("received data:"+data);
      			var ctx = $('#avg-chart').html('<i class="fas fa-spinner fa-pulse"></i>');
  	  			var currentSim = data;
  	  			timerId= setInterval(function(){updateData(currentSim)},5000);
    		}
    )});
  });

			
		</script>
</body>
</html>
